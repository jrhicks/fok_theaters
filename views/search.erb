<HTML>
<head>
<title>Forks Over Knives</title>
<style>
h1 {
  padding-top: .5em;
  font-size: 26px;
  font-style: normal;
  font-weight: 400;
  text-shadow: none;
  text-decoration: none;
  text-transform: none;
  letter-spacing: 0em;
  word-spacing: 0em;
  line-height: 1;
  padding-bottom: 0;
  margin-bottom: .5em;
}
h2 {
  font-size: 20px;
  font-style: normal;
  font-weight: 400;
  text-shadow: none;
  text-decoration: none;
  text-transform: none;
  letter-spacing: 0em;
  word-spacing: 0em;
  line-height: 1;
}

body {
font:normal 12px/20px "Lucida Grande", Verdana, Arial, sans-serif;
margin:0;
padding:0 0 15px 0;}


</style>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script> 
<%if false%>
<script type="text/javascript" src="http://maps.google.com/maps?file=api&v=2&key=<%=GOOGLE_API_CODE%>">
<%end%>

</head>

<script type="text/javascript">
	var directionDisplay;
	var directionsService = new google.maps.DirectionsService();
	var map;
  var bounds = new google.maps.LatLngBounds()

	<% for theater in THEATERS %>
		var mark<%=theater.object_id%>;
	<%end %>

	function loadPoints() {
		
		<% for t in THEATERS %>
		var point = new google.maps.LatLng(<%=t[:latitude]%>,<%=t[:longitude]%>);
		bounds.extend(point);
    mark<%=t.object_id%> = new google.maps.Marker({
        position: point,
        title:"<%=t[:name]%>"
      });    
    mark<%=t.object_id%>.setMap(map);
    google.maps.event.addListener(mark<%=t.object_id%>, 'click', function() {
        calcRoute("<%=t[:address]%> <%=t[:city]%>  <%=t[:state]%>");
      })
		<%end %>
		map.panToBounds(bounds);
	};
	
	
	function initialize() {
	  directionsDisplay = new google.maps.DirectionsRenderer();
	  var source = new google.maps.LatLng(<%=@source_lat%>, <%=@source_lon%>);
	  var myOptions = {
		zoom:7,
		mapTypeId: google.maps.MapTypeId.ROADMAP,
		center: source
	  }
	  map = new google.maps.Map(document.getElementById("map"), myOptions);
	  directionsDisplay.setMap(map);
    calcRoute("<%=@nearest[:address]%> <%=@nearest[:city]%>  <%=@nearest[:state]%>");
	  loadPoints();
	}

	function calcRoute(destination) {
	  var start = "<%=params[:address]%>";
	  var end = destination;
	  var request = {
		origin:start,
		destination:end,
		travelMode: google.maps.TravelMode.DRIVING
	  };
    directionsDisplay.setPanel(document.getElementById("directionsPanel"));
	  directionsService.route(request, function(result, status) {
		if (status == google.maps.DirectionsStatus.OK) {
		  directionsDisplay.setDirections(result);
		}
	  });
	}	

</script>



<body style="margin: 0px; padding: 0px;" onLoad="initialize();">
	
	<div style="width: 100%; text-align: center;" id="wrapper">
		<h1>Forks Over Knives - Nearest Theater</h1>
	</div>

  <div style="background-color: #EEE; width: 100%; border: 1px solid #CCC; padding: 1em; margin-bottom: 2em;">
	<div style="width: 100%; text-align: center;">
		<form action="search" style="padding: 0; margin: 0;">
			Display directions from <b><%=params[:address]%></b> to 
      <select onchange="calcRoute(this.value);">
        <%for t in @sorted_theaters%>
        <option <%="SELECTED" if t[:name]==@nearest[:name]%> value="<%=t[:address]%> <%=t[:city]%>  <%=t[:state]%>"> <%=t[:name]%>
        <%end%>
      </select>
       
		</form>
	</div>
  </div>  
		
	<div style="width: 780px; margin: auto;">
    <div id="map" style="width:375px; height: 375px; float: left;"></div>
    <div id="directionsPanel" style="padding-left: 10px; width:375px; float: left;"></div>
  </div>
	
	<div style="width: 800px; margin: auto; clear: left;">
  <br>
  <p>
	After months of worsening conditions with ineffective treatments, my loved sister is curing her Sarcoidosis thanks to a plant-strong diet. Thank You Doctors!
  </p>
  <p>
	Twitter: @jrhicks
  </p>
	</div>
</body>

</html>